
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="Godot Game Development">
    <meta name="author" content="nightblade">

        <title>Godot Game Development</title>


    <!-- Bootstrap core CSS -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">


    <link rel="stylesheet" href="https://nightblade9.github.io/godot-gamedev/theme/css/main.css">

    <link rel="stylesheet" href="https://nightblade9.github.io/godot-gamedev/theme/css/solarized-light.css">


    <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

  
</head>

<body>
  <div class="container" id="wrap">
      <nav id="navbar" class="navbar navbar-default" role="navigation">
    <div class="container">

      <!--navbar-header-->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
  
        <a class="navbar-brand" href="https://nightblade9.github.io/godot-gamedev">Home</a>

        <p class='navbar-brand'>|</p>

          <a class="navbar-brand" href="https://nightblade9.github.io/godot-gamedev/pages/about.html">About</a>

        <p class='navbar-brand'>|</p>

          <a class="navbar-brand" href="https://www.deengames.com">Deen Games</a>
      </div> <!--navbar-header-->

      <!-- Search Box -->

      <!--Menuitems, collapable-->
      <div class="collapse navbar-collapse" id="navbar-collapse">
        <ul class="nav navbar-nav navbar-right" id="menuitem-list">
        </ul>
      </div><!-- /.navbar-collapse -->

    </div> <!--container-->
  </nav>

    
    <div class="list-group">
      </strong>Categories:
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/devlog.html">Devlog</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/game-design.html">Game Design</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/game-development.html">Game Development</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/news.html">News</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/retrospective.html">Retrospective</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/technical.html">Technical</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/web-development.html">Web Development</a> |</span>
    </div>

    <div class="container">
      <div class="col-md-2">
      </div>

      <div class="col-md-8">
        <div class="row">
          
        </div>

        <div class="row">

  <!--<script type="text/javascript">-->
    <!--/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */-->
    <!--var disqus_shortname = 'yuex'; // required: replace example with your forum shortname-->

    <!--/* * * DON'T EDIT BELOW THIS LINE * * */-->
    <!--(function () {-->
    <!--var s = document.createElement('script'); s.async = true;-->
    <!--s.type = 'text/javascript';-->
    <!--s.src = '//' + disqus_shortname + '.disqus.com/count.js';-->
    <!--(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);-->
    <!--}());-->
  <!--</script>-->

  <div id="home_article_list" class="panel-group" id="accordion">

    <div class="panel panel-primary">
      <div class="panel-heading panel-title">
        <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2020">2020</a> - <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2020Month01">January</a>
      <a class="accordion-toggle" data-toggle="collapse" 
        title="toggle folding"
        href="#collapseArticle1">
        <span class="pull-right badge">
          #15
        </span>
      </a>
      </div>

      <div class="panel-body hidden">

      </div>

      <ul class="list-group">
        <a href="https://nightblade9.github.io/godot-gamedev/2020/a-primer-on-aabb-collision-resolution.html">
          <li class="list-group-item">
            <h1>A Primer on AABB Collision Resolution</h1>
          </li>
        </a>
        <div class="collapse in"
          id="collapseArticle1">
          <li class="list-group-item">
              <span id="article_info">
    <a class="label label-primary"
      href="https://nightblade9.github.io/godot-gamedev/category/technical.html">Technical</a>
      <b> · </b>
        <a class="label label-primary"
          href="https://nightblade9.github.io/godot-gamedev/tag/physics.html">Physics</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2020">2020</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2020Month01">01</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2020Month01">30</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="https://nightblade9.github.io/godot-gamedev/author/nightblade.html">nightblade</a>
  </span>

            <a class="pull-right" href="https://nightblade9.github.io/godot-gamedev/2020/a-primer-on-aabb-collision-resolution.html">
              </a>
          </li>
          <li class="list-group-item"><p><img alt="video demo" src="https://i.imgur.com/GLQzqUP.gif"></p>
<p>This blog post includes a discussion about AABB collision resolution: what it is and isn't, it's strengths and weaknesses, some common pitfalls, and how you can (hopefully) implement it in your low-level gaming tool of choice, if needed.</p>
<p>I learned all this (the second time) as part of adding fast/stable collision resolution to <a href="https://nightblade9.github.io/puffin">Puffin</a>, a fast, lightweight 2D game engine built on top of MonoGame.</p>
<h2>AABB, Collision Detection, and Collision Resolution</h2>
<p>Some quick definitions to start:</p>
<ul>
<li>AABB (Axis Aligned Bounding Boxes) means two non-rotated boxes, that are aligned on one axis. In 2D, everything on the same "layer" or "z" is on the same axis; in 3D, it means your boxes are on the same plane.</li>
<li>Collsiion detection means detecting if there is a collision (two AABBs overlapping) or will be a collision (eg. in 0.3s these two will start colliding).</li>
<li>Collision resolution means resolving the collision. Broadly, there are two approaches to this: prevention or pre-collision resolution (stop just at the onset of collision when the two AABBs touch), and post-collision resolution (once two AABBs overlap, move them backward in time until they no longer overlap).</li>
</ul>
<p>My approach to AABB uses pre-collision resolution, because it tends to be less complex and more stable.</p>
<h2>Pros and Cons of AABB</h2>
<p>Why should you use AABB collision resolution? There are many other options, such as collision points, sphere/line collsion algorithms, polygons, etc.</p>
<p>The strengths of AABB include:</p>
<ul>
<li>It works well in most cases. Most games can do well enough with just bounding boxes on their entities.</li>
<li>It's relatively simple to code (math-wise), because it's just boxes.</li>
<li>It's quite cheap computationally (eg. doesn't have an expensive square-root calculation, unlike spherical checks)</li>
</ul>
<p>However, it includes some drawbacks:</p>
<ul>
<li>It doesn't work with rotated boxes</li>
<li>It doesn't work well with non-box shapes</li>
<li>It requires extra work for it to work well with multi-entity collisions</li>
<li>It's succeptible to "tunnelling" (high-speed objects move through solid objects because of their velocity)</li>
</ul>
<p>If you can live with those limitations, I recommend AABB, primarily because it is computationally cheap (works well with a high number of colliding entities).</p>
<h2>Collision Resolution is Complex, like Physics</h2>
<p>While AABB collision resolution is <em>relatively</em> easier to code, it doesn't mean it's <em>easy</em> to code. Many game frameworks don't include collision resolution, because this is part of the physics engine.</p>
<p>Read that again: it's often part of the <em>physics engine</em>. Physics engines are notoriously difficult to get right, and require lots of fiddling and corner-case evaluation. Even high-quality physics engines have limitations, such as tunneling.</p>
<p>It took me around 10 hours to discover all the caveats and get this to work right. And it works well, including with multi-entity collisions. Test thoroughly.</p>
<p>That said, my implementation includes a few bonus features:</p>
<ul>
<li>It's resistant to collision tunneling (but not impervious)</li>
<li>It works with multiple objects colliding at the same time</li>
<li>It allows an object to optionally "collide and slide" along the object it collides with</li>
</ul>
<p>With that out of the way, let's dive into the actual theory of how to make a stable AABB resolution, and then some code.</p>
<h2>High-Level Description of AABB</h2>
<p>AABB collision resolution works by looking at the X and Y component resolutions of your velocity. Simply put:</p>
<ul>
<li>Consider the intended destination of your moving entity (where it will be after updating its position, not where it is now)</li>
<li>Look at the distance <code>dx</code> to travel before we collide on the X-axis and <code>dy</code> for the Y-axis</li>
<li>Divide these by your component X-velocity and Y-velocity respectively (<code>vx</code> and <code>vy</code>) to figure out how long before each axis collision takes place (<code>tx</code> and <code>ty</code>)</li>
<li>Resolve the collision on the axis that collides first</li>
</ul>
<p><img alt="AABB sweep test with velocity" src="https://i.imgur.com/gCtzUeJ.png"></p>
<p>This excellent diagram (credit: LaroLaro on <a href="https://gamedev.stackexchange.com/questions/28577/2d-aabb-vs-aabb-sweep-how-to-calculate-hit-normal">GameDev.SE</a>) shows a moving object (A) that will collide with a second object (B). Based on the component velocities, you can see from the projected A box that the faster collision will be on the Y-axis first.</p>
<p>Because collision resolution takes place on a single axis at a time, you may end up having to resolve the same collision multiple times to get a stable resolution. I find that running the collision resolution twice suffices.</p>
<h2>And Now, the Code</h2>
<p>Below, I discuss some pseudocode that's almost the same as the actual (C#) code from Puffin. The same code can apply to any programming language or framework.</p>
<p>One unorthodox implementation detail I used: when each entity moves, I make a note of their "intended" destination X/Y. If that location would cause it to collide inside an object, I instead update it so it stops just at the point of collision.  In my pseudocode below, you'll see this as <code>intendedX</code> and <code>intendedY</code>.</p>
<p>For every collidable entity, you're going to compare it to every other collidable entity. Since we're using AABBs, this is pretty simple: just compare the coordinates plus intended movement of the moving entity, against the entity that isn't moving:</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">isAabbCollision</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">h1</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">w2</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">h2</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Adapted from https://tutorialedge.net/gamedev/aabb-collision-detection-tutorial/</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">w2</span><span class="w"> </span><span class="p">&amp;&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">x1</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">w1</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="p">&amp;&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">y1</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="n">y2</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">h2</span><span class="w"> </span><span class="p">&amp;&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">y1</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">h1</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">y2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You simply call this with <code>e1.x + e1.velocity.x, e1.y + e1.velocity.y, e1.width, e1.height, e2.x, e2.y, e2.width, e2.height</code> and it will return if they collide or not.</p>
<p>However, to stop at the point of collision, we need to consider our entity's velocity: if it's moving right, then the distance to collide on the X-axis is the right edge of <code>e1</code> compared to the left-edge of <code>e2</code>. If it's moving left, then vice-versa (left edge of <code>e1</code> vs. the right edge of <code>e2</code>). The same thing applies when we resolve on the Y-axis.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Assuming we have two AABBs, what&#39;s the actual distance between them?</span>
<span class="c1">// eg. if `e1` is on the left of `e2`, we want `dx` to be `e2.left - e1.right`.</span>
<span class="k">private</span><span class="w"> </span><span class="nf">static</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="p">)</span><span class="w"> </span><span class="n">CalculateAabbDistanceTo</span><span class="p">(</span><span class="n">Entity</span><span class="w"> </span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="n">Entity</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">dx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">dy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">dx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="p">-</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">Width</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">dx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="p">-</span><span class="w"> </span><span class="p">(</span><span class="n">e2</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">Width</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">dy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">-</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">dy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">-</span><span class="w"> </span><span class="p">(</span><span class="n">e2</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Then, for every collidable entity, if it results in an AABB collision with another collidable entity, we figure out which axis collides first, based on which one collides first time-wise:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Another entity occupies that space. Use separating axis theorem (SAT)</span>
<span class="c1">// to see how much we can move, and then move accordingly, resolving at whichever</span>
<span class="c1">// axis collides first by time (not whichever one is the smallest diff).</span>
<span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">xDistance</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">yDistance</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">CalculateAabbDistanceTo</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">);</span><span class="w"></span>
<span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">xVelocity</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">yVelocity</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">VelocityX</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">VelocityY</span><span class="p">);</span><span class="w"></span>
<span class="kt">float</span><span class="w"> </span><span class="n">xAxisTimeToCollide</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">xVelocity</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">xDistance</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="n">xVelocity</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>
<span class="kt">float</span><span class="w"> </span><span class="n">yAxisTimeToCollide</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">yVelocity</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">yDistance</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="n">yVelocity</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>
</code></pre></div>

<p>Resolving collision based on collision time solves some corner-cases where an object is very close to collision on one axis, but moving much faster on the other axis (eg. a player falling off a tall building moves into it, and instead of colliding against the side, he collides with the top).</p>
<p>Once we know which collision is first, it's easy to resolve if the collision is only on one axis:</p>
<div class="highlight"><pre><span></span><code><span class="kt">float</span><span class="w"> </span><span class="n">shortestTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">xVelocity</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">&amp;&amp;</span><span class="w"> </span><span class="n">yVelocity</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Colliison on X-axis only</span>
<span class="w">    </span><span class="n">shortestTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">xAxisTimeToCollide</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaX</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">shortestTime</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="n">xVelocity</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">xVelocity</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">&amp;&amp;</span><span class="w"> </span><span class="n">yVelocity</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Collision on Y-axis only</span>
<span class="w">    </span><span class="n">shortestTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">yAxisTimeToCollide</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaY</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">shortestTime</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="n">yVelocity</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Finally, the most complex case: what do we do if the object would collide on both X- and Y-axes? We resolve the fastest collision first:</p>
<div class="highlight"><pre><span></span><code><span class="k">else</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Collision on X and Y axis (eg. slide up against a wall)</span>
<span class="w">    </span><span class="n">shortestTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">Min</span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">xAxisTimeToCollide</span><span class="p">),</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">yAxisTimeToCollide</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaX</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">shortestTime</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="n">xVelocity</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaY</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">shortestTime</span><span class="w"> </span><span class="p">*</span><span class="w"> </span><span class="n">yVelocity</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Easy! If it would take 0.1s to collide on the X-axis, and 0.2 on the Y-axis, we increment the entity's X and Y by their velocity times 0.1 (the faster collision time).</p>
<p>Finally, for stable resolutions, make sure you run the collision resolution twice per update. Since MonoGame-based frameworks give you the update time, simply run the update twice, with half of the elapsed time, each update:</p>
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">halfElapsed</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMilliseconds</span><span class="p">(</span><span class="n">elapsed</span><span class="p">.</span><span class="n">TotalMilliseconds</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="m">2</span><span class="p">);</span><span class="w"></span>
<span class="c1">// Resolve collisions twice to stabilize multi-collisions.</span>
<span class="k">this</span><span class="p">.</span><span class="n">ProcessMovement</span><span class="p">(</span><span class="n">halfElapsed</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">);</span><span class="w"></span>
<span class="k">this</span><span class="p">.</span><span class="n">ProcessMovement</span><span class="p">(</span><span class="n">halfElapsed</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<p>That's it, you're done!</p>
<h2>Slide on Collide</h2>
<p>With basic collision resolution out of the way, you might ask "how do I slide up against the target object instead of simply stopping abruptly?"</p>
<p>The answer to that caused about 50% of my development time. The answer is "you collide as usual but then move on the other axis as much as is reasonable," where reasonable means "don't move so much you collide with something else." In this case, don't slide if doing so would land you in another AABB collision.</p>
<p>Another complication I can't explain well is my need to refer to the "old" intended X/Y distances; I'm not 100% sure at this moment why I needed those, but those are needed for a proper resolution.</p>
<p>Some code:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">SlideOnCollide</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Setting oldIntendedX/oldIntendedY might put us directly inside another solid thing.</span>
<span class="w">        </span><span class="c1">// No worries, we resolve collisions twice, so the second iteration will catch it.</span>

<span class="w">        </span><span class="c1">// Resolved collision on the X-axis first</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shortestTime</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="n">xAxisTimeToCollide</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Slide vertically</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaX</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="c1">// If we&#39;re in a corner, don&#39;t resolve incorrectly; move only if we&#39;re clear on the Y-axis.</span>
<span class="w">            </span><span class="c1">// Fixes a bug where you  move a lot in the corner (left/right/left/right) and suddenly go through the wall. </span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(!</span><span class="n">isAabbCollision</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">oldIntendedY</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">Height</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">collideAgainst</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">collideAgainst</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">Height</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaY</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">oldIntendedY</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Resolved collision on the Y-axis first</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shortestTime</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="n">yAxisTimeToCollide</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Slide horizontally</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaY</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="c1">// If we&#39;re in a corner, don&#39;t resolve incorrectly; move only if we&#39;re clear on the X-axis.</span>
<span class="w">            </span><span class="c1">// Fixes a bug where you  move a lot in the corner (left/right/left/right) and suddenly go through the wall.</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(!</span><span class="n">isAabbCollision</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="n">oldIntendedX</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">Height</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">collideAgainst</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">collideAgainst</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">.</span><span class="n">Height</span><span class="p">))</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaX</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">oldIntendedX</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<h2>Wrapping it All Up</h2>
<p>That concludes a somewhat whirlwind tour of AABB collision detection. I hope you came out of it understanding the pros and cons, how to assess when you need it or not, and enough pseudo-code to actually get it working for you.</p>
<p>I would love to hear from you! If you have any feedback, please drop me a message/tweet <a href="https://twitter.com/nightblade99">on Twitter</a>.</p></li>
          <li class="list-group-item text-right">
            <div class="btn-group">
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2020/a-primer-on-aabb-collision-resolution.html#disqus_thread" title="comments">
                <span class="glyphicon glyphicon-comment" data-disqus-identifier="a-primer-on-aabb-collision-resolution">
                </span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2020/a-primer-on-aabb-collision-resolution.html" title="permanent link">
                <span class="glyphicon glyphicon-link"></span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2020/a-primer-on-aabb-collision-resolution.html" title="read more">
                <span class="glyphicon glyphicon-plus"></span></a>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <div class="panel panel-primary">
      <div class="panel-heading panel-title">
        <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a> - <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month10">October</a>
      <a class="accordion-toggle" data-toggle="collapse" 
        title="toggle folding"
        href="#collapseArticle2">
        <span class="pull-right badge">
          #14
        </span>
      </a>
      </div>

      <div class="panel-body hidden">

      </div>

      <ul class="list-group">
        <a href="https://nightblade9.github.io/godot-gamedev/2019/integrating-religion-into-games.html">
          <li class="list-group-item">
            <h1>Integrating Religion Into Games</h1>
          </li>
        </a>
        <div class="collapse in"
          id="collapseArticle2">
          <li class="list-group-item">
              <span id="article_info">
    <a class="label label-primary"
      href="https://nightblade9.github.io/godot-gamedev/category/game-development.html">Game Development</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month10">10</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month10">30</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="https://nightblade9.github.io/godot-gamedev/author/nightblade.html">nightblade</a>
  </span>

            <a class="pull-right" href="https://nightblade9.github.io/godot-gamedev/2019/integrating-religion-into-games.html">
              </a>
          </li>
          <li class="list-group-item"><p><img src="https://i.imgur.com/qr8ljtY.jpg" alt="screenshot of a verse of Qur'an in Eman Quest" width="750" height="474" /></p>
<p>I recently engaged in a conversation with someone about religion and games; specifically, about me showing, explaining, and playing the audio of verses of the Qur'an in my games. This discussion lead me to think about, question, evaluate, and eventually understand (at a deeper level) why I do this, and why I included that section in that game.</p>
<p>To summarize: I think the use of religion (specifically, elements of Islam and Muslim culture) in games is essential for many reasons, including breaking stereotypes and building a deeper understanding of what Islam's canonical texts really mean. In fact, the word "deen" in "Deen Games" means religion, but it also means "a way of life."</p>
<h2>Why Integrate Religion Into Games?</h2>
<p>So, the core issue: why bother mixing religion with games? Certainly, this is not something people ask for (barring a very narrow definition of "game" and focusing on educational aspects, usually in the form of quizzes).</p>
<p>Some thoughts that come to mind:
- Religion, in general, is something that is often looked down upon as "backward," "violent," and not useful.
- Religion in games, is seen as almost a taboo; something people just don't do.
- In the past, some people have made thinly-veiled religious propaganda as games</p>
<p>In particular, if you look at the demographic of Muslims, it paints a similarly bleak picture:
- Muslims are often portrayed as terrorists, oppressors, and backward in media
- Games are no better - Muslims commonly appear as the antagonists in first-person shooters, supplanting Nazis</p>
<p>Knowing all this, a not-so-obvious solution becomes obvious: why not use games to counter the negativity and stereotypes around religion and Islam in particular? Games reach around the world, but can uniquely engage players interactively; can create fantsatic scenarios that don't exist outside; and can cast players in the role of those they wouldn't normally choose to be. Games can show an alternative view, and potentially build empathy for marginalized groups. (In fact, some ideologies already use games to achieve all these goals.)</p>
<p>That brings us back to Deen Games. Our mission is not to create religious propaganda or poorly-disguised quizzes. We actively work to create fun, innovative, unique, accessible games that include Muslim culture, history, and beliefs as an integral part of the game universe.</p>
<p>As one person <a href="https://twitter.com/bcscarbrough/status/1188791237089857537">aptly tweeted</a>: </p>
<blockquote>
<p>If your beliefs do not bleed into your creative process on some level, they are not your beliefs. I expect a game made by Muslims to have some aspects of their beliefs even if they're not overt. Scrubbing games of every hint of a belief system to avoid offense is imo offensive.</p>
</blockquote>
<h2>What we can Learn from Islamic Games</h2>
<p><img alt="data cube in Ali the Android which references a verse of Qur'an" src="https://i.imgur.com/v15ki7y.png"></p>
<p>My specific interest within Islamic games is to create games that leave the player with an understanding and practical application of canonical texts of Islam through games. Because games allow us to create arbitrary fantastical scenarios and situations (fantasy and sci-fi in particular), this provides us a rich, fertile ground for creative expression and building a real understanding.</p>
<p>Creating Islamic games with visibly Muslim characters not only breaks stereotypes, but it also normalizes us in popular culture, contrary to how we're often portrayed in media.</p>
<p>It also confers an additional benefit: it allows us to easily break the common tropes/stereotypes of games. For example, a fantasy game <a href="https://deengames.itch.io/eman-quest">like Eman Quest</a> might contain slimes, bats, sentient rocks; but also jinns and other creatures/elements drawn from our Islamic theology and history.</p>
<h2>It's a Trade-Off Though</h2>
<p>Like choosing a pixel-art or low-poly aesthetic to your game, choosing to include Islamic elements comes with some down-sides. I expect the benefits to (greatly) overwhelm the downsides, which include:</p>
<ul>
<li>This can break immersion. In particular, the Islamic content must be well-integrated into world lore.</li>
<li>It doesn't appeal to everyone. A rather vocal group exists decrying religion in games. Even Nintendo <a href="http://www.escapistmagazine.com/articles/view/features/15045-Nintendo-of-America-Used-Religious-Censorship-to-Avoid-Controver">has a history</a> of <a href="https://kotaku.com/losing-our-religion-5509744">removing religious elements</a> from <a href="https://en.wikipedia.org/wiki/ActRaiser#Religious_subtext">various games</a>.</li>
<li>It takes practice to integrate religious identity and iconography and beliefs in games - especially if you don't want a very superficial integration.</li>
<li>Not every religious quote, source, message, symbol, etc. can or should be integrated into games.</li>
</ul>
<h2>Closing Thoughts</h2>
<p>Thanks for taking the time to read this! I highly encourage you to <a href="https://twitter.com/nightblade99">drop me some comments on Twitter</a> and let me know your thoughts.</p>
<p>Or, if you feel up to it, why not include a visibly Islamic element/character/outfit in your next game? I would be happy to work with you on this to define something you feel happy about including in your games.</p></li>
          <li class="list-group-item text-right">
            <div class="btn-group">
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/integrating-religion-into-games.html#disqus_thread" title="comments">
                <span class="glyphicon glyphicon-comment" data-disqus-identifier="integrating-religion-into-games">
                </span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/integrating-religion-into-games.html" title="permanent link">
                <span class="glyphicon glyphicon-link"></span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/integrating-religion-into-games.html" title="read more">
                <span class="glyphicon glyphicon-plus"></span></a>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <div class="panel panel-primary">
      <div class="panel-heading panel-title">
        <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a> - <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month08">August</a>
      <a class="accordion-toggle" data-toggle="collapse" 
        title="toggle folding"
        href="#collapseArticle3">
        <span class="pull-right badge">
          #13
        </span>
      </a>
      </div>

      <div class="panel-body hidden">

      </div>

      <ul class="list-group">
        <a href="https://nightblade9.github.io/godot-gamedev/2019/eman-quest-retrospective.html">
          <li class="list-group-item">
            <h1>Eman Quest Retrospective</h1>
          </li>
        </a>
        <div class="collapse in"
          id="collapseArticle3">
          <li class="list-group-item">
              <span id="article_info">
    <a class="label label-primary"
      href="https://nightblade9.github.io/godot-gamedev/category/retrospective.html">Retrospective</a>
      <b> · </b>
        <a class="label label-primary"
          href="https://nightblade9.github.io/godot-gamedev/tag/godot.html">Godot</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month08">08</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month08">22</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="https://nightblade9.github.io/godot-gamedev/author/nightblade.html">nightblade</a>
  </span>

            <a class="pull-right" href="https://nightblade9.github.io/godot-gamedev/2019/eman-quest-retrospective.html">
              </a>
          </li>
          <li class="list-group-item"><p><img src="https://i.imgur.com/rpSFnxr.png" alt="screenshot of the protagonist in a cave map" width="750" height="450" /></p>
<p>Welcome to the rather large retrospective on <a href="https://deengames.itch.io/eman-quest">Eman Quest</a>. Eman Quest, if you haven't heard about it, is a "procedurally-generated mini-RPG with memory mechanics." You can try the full game, for free, on Itch.</p>
<p>This retrospective covers two parts: first, the overall idea (what did I plan to achieve? What did I actually achieve? Reflections), and the key lessons learned (mostly specific to Godot).</p>
<h1>The Overall Idea: A Procedurally-Generated RPG</h1>
<p>I really like procedural content generation (in general), although it's deceptively difficult to implement correctly (corner cases really get you). I always wanted to make a "procedurally-generated Chrono Trigger-like RPG," although that's a huge undertaking; Eman Quest was the first step: creating a small, "lightweight" or "mini" RPG.</p>
<p>What, exactly, did I include in Eman Quest?</p>
<ul>
<li>A fixed story about life, faith, and family</li>
<li>Seven different areas; these are three geographies (forest, cave, and dungeon) each with multiple biomes (frost forest, death forest, desert dungeon, etc.)</li>
<li>A unique world: each time you play a new game, it picks three out of seven biomes, and generates the required maps for each.</li>
<li>Unique enemies, two per area, statically-generated and balanced with careful trade-offs (eg. glass cannon, tank), and a unique boss per biome.</li>
<li>Procedurally-generated equipment (weapons, armour), including their stats</li>
<li>A battle system that relies on not puzzle/thinking or skills/reflexes, but memory: remember the selected tiles, pick them to get action points, chain them to get tech points, and then use them for your turn.</li>
<li>Two fixed skills in battle</li>
<li>A progression system with experience, levels, and stats points you can distribute to your liking (respeccing is free).</li>
</ul>
<p><img src="https://i.imgur.com/2bx1y6M.gif" alt="one round of battle" width="750" height="450" /></p>
<p>I didn't include many things in Eman Quest; specifically, I analyzed Bastion, how they cut corners to cut down on the amount of content they needed to complete the game, and applied it to my game. Specificially:</p>
<ul>
<li>I scrapped procedural story-, world-, event-, and character-creation, and wrote a fixed story instead</li>
<li>I scrapped the world map, because it adds little or no value</li>
<li>I didn't incude any NPCs or shops, because those require a lot of art/coding. (You always find better equipment in chests than what you're using.)</li>
<li>I cut a few things in content: avatars, some biome variants (crystal caves), variant bosses, and unique final-boss skills.</li>
</ul>
<h1>What Went Well</h1>
<p>Overall, I am very happy with the result, and thankful that I could finish this project, although it doesn't come quite close to my initial vision (due to scope cuts and resource/time constraints).</p>
<p>Things I really like about Eman Quest:</p>
<ul>
<li>It "feels" like a procedurally-generated RPG.</li>
<li>It's balanced (monsters seem quite distinct/different to fight) even though it's on the easy side</li>
<li>Quite a few people completed the game</li>
<li>The memory mechanics received some compliments (more on the design below)</li>
<li>I shipped. Especially considering I tend to abandon long-running projects, this is especially important to me</li>
<li>I polished the game considerably, including audio (background and sound-effects)</li>
<li>I received some fan-art, and several questions about my protagonist; which prompted me to create an elaborate background, and a character representing many minorities: a strong woman, a Muslim, and an African</li>
<li>I represented Muslims and Islam positively, and communicated one of our values (good treatment of parents)</li>
<li>I learned a lot about game accessibility, and added a few accessibility options into my game</li>
</ul>
<p>Below, you can see the fan-art of the protagonist, Aisha.</p>
<p>As my first full Godot project, I'm not really proud of the code quality; as I joked on <a href="https://discord.gg/frKXYtG">my Discord server</a>, code quality decreases as you get closer to production!</p>
<p><img src="https://i.imgur.com/LeKMWbk.jpg" width="600" height="570" /></p>
<h2>Memory Mechanics</h2>
<p><img alt="memory mechanics screenshot" src="https://i.imgur.com/xOOetlV.png"></p>
<p>Aside from the technical challenge of creating a procedural RPG, I challenged myself to create a fun battle mechanic based on memory instead of reflexes or puzzles.  I also received lots of good feedback about this from users, who praised the memory mechanic as interesting.</p>
<p>The core mechanic works simply: a 5x5 grid appears, some squares highlight for a fractional second, and then disappear. You need to click on those highlighted tiles to accumulate "action points," which you can use for different actions (attack costs 2, critical costs 3, and defend/heal costs 1).</p>
<p>In initial prototypes, I experimented with requiring players to pick both energy (action poinst) and actions they wanted to play. This proved to be quite "stressful," because you have a fractional second to look for both required energy tiles and action tiles; midway through development, I streamlined it into what it is now.  I also tried several variations (incluiding a "simon says" type mini-game and a stream of "which of these items did you never see before"), both of which didn't seem fun enough to include in the final.</p>
<p>I also found that battles become somewhat rote and mechanical/deterministic after a while: you pick the five specified tiles, then pick crit, attack, and repeat, healing as necessary.  To change it up, and to reward skillful play, I added techniques/skills and technical points.</p>
<p>Players who pick three or more tiles correctly in a row (with no mistakes) acquire tech points. If you select all five tiles correctly, you get a total of three tech points. You can save these up and use either five or seven for stun/vampire skills respectively. This adds an element of strategy and non-determinism.  Tech poinst also persist across battles, adding another dimension of planning.</p>
<h1>What Didn't Go Well + Key Insights</h1>
<p>I initially planned one month to complete the project; it ended up taking around nine months. Why? Many reasons, including:</p>
<ul>
<li>I realized early on that different forests just didn't cut it, and needed both variation (styles of forests) and map types (cave, dungeon, etc.)</li>
<li>Creating art was not my strong-suite, and I needed three distinct tilesets, each with two unique variations</li>
<li>Finding, drawing and animating 14 monsters, and their walk cycles, took a lot of effort; even though I found many of the base sprites and received lots of help on the art side.</li>
<li>I added the story about five months in, and required implementing an entire message dialog system, key-item system, final-game events, and lots of unexpected things.</li>
<li>Technical struggles with, and crashes in, Godot (more on that below).</li>
</ul>
<p>I ran into several difficulties along the way.  These include:</p>
<ul>
<li>Learning Godot's API, which seemed quite foreign to me (anything is a scene and can contain sub-scenes). Also, Godot is quite a wide framework, and it takes time to discover/learn/use things (like UI components).</li>
<li>Learning about Godot's automatic garbage-collection (<code>free</code> and <code>queue_free</code>) and how they destroy all objects when changing scenes. This caused me to rewrite my early version to completely separate data about maps (tiles, treasure, etc.) from the visual presentation of those, which got GCed.</li>
<li>I wrote garbage, prototype-quality code throughout. This lead to numerous bugs (some difficult to diagnose and fix), and a cycle of "fix something but break something else" late in development. You can see tweets with some bugs, including a few hilarious ones, <a href="https://twitter.com/search?q=%40nightblade99 %23EmanQuest %23Bugs">here</a>.</li>
<li>I didn't write any unit or integration tests. This meant I could break things without noticing for days/weeks. I remedied this quite late in development by using GUT (Godot Unit Testing).</li>
<li>Lack of CI. Unlike other, C#-based projects, I couldn't get Travis to run my tests; so if I forgot to run tests, broken things stay unnoticed.</li>
<li>The final game crashed a lot, which caused a lot of stress and resulted in a lot of lessons; so I wrote a section just on that.</li>
<li>Close to the end of development, I lost my GPU on my main development machine, and my main Windows installed contained drivers that didn't run with Godot 3.0.6. I ended up switching to Linux (which included up-to-date drivers), but lost of a lot of time; I also upgraded Godot to 3.1.1, which initially showed a problem with cave maps running at 2-3FPS, but works fine on Linux.</li>
<li>Serialization for saving games. As <a href="https://docs.godotengine.org/en/3.1/tutorials/io/saving_games.html">the Godot docs on saving games</a> suggests, you need to <em>manually</em> serialize all your (nested, hierarchial) data structures into JSON. This requires a lot of boilerplate, and it's very tedious (you may miss a field and not realize unless you test thoroughly).</li>
</ul>
<h2>The Game Crashed on Release</h2>
<p>When I released the game, it crashed. A lot. This undoubtedly resulted in a terrible first-impression, although I received several supportive comments such as "it crashed once and then I reloaded and it was fine" or "it keeps crashing after battles but I completed the game."</p>
<p>Why did it crash, why didn't I notice, and how did I fix the crashes?  Well, I'm glad you asked.</p>
<p>Godot runs the game in the editor, somewhat differently from when you export the final platform-specific release. This includes differences such as caring about case-sensitivity (which the Editor doesn't, on Windows), and - critically - crashing when you do Bad Things (like waiting for an event and disposing the scene before it comes back).</p>
<p>I always tested Eman Quest from within the editor, so I never noticed (or cared to notice?) the errors. The game also crashed on Linux and (troublingly) MacOS (which I don't have hardware to test with), but not on Windows, so I failed to catch it in my pre-release testing.</p>
<p>In the end, I upgraded Godot from 3.0.6 to 3.1.1 (someone commented that it didn't work with their graphics card, and 3.1.1 works with OpenGLES 3.1 and earlier), and the crashes disappeared.  I also:</p>
<ul>
<li>Tested on Linux (after switching to Linux) and found I could reproduce, and fix, one crash</li>
<li>Fixed sporadically-appearing errors that Godot printed out, which fixed at least one crash</li>
<li>Received great offers of help from people on Twitter, specifically running MacOS, who found workflows in-game that reproduced the crash, and verified after I fixed them.</li>
</ul>
<h1>Action Items</h1>
<p>I learned several key lessons out of this. Learning about Godot itself proved invaluable; beyond that:</p>
<ul>
<li><strong>Write clean code.</strong> (Clean meaning, as good as you can make it.) This results in less bugs and less painful troubleshooting later on when things turn bad.</li>
<li><strong>Export and test your project often.</strong> This catches bugs, crashes, and all kinds of badness that you don't want players to find first.</li>
<li><strong>Fix all runtime errors, and any errors/warnings Godot generates.</strong> These often foreshadow crashes when the game runs (sometimes, only on select platforms - Windows seems fairly resilient)</li>
<li><strong>Unit test everything.</strong> Unit testing is cheap, runs quickly, and pays for itself in spades; you can quickly catch issues without manually retesting everything.</li>
<li><strong>Set up a continuous integration pipeline to run your tests.</strong> With GitHub and Travis, you can check in code, and get an email whenever you broke some tests (but didn't notice by running them manually). That can be invaluable to avoid breaking things that work.</li>
<li><strong>The Godot community is awesome.</strong> Ask on Discord, open a GitHub issue, post a tweet - there are experienced developers who will get back to you, promptly, with solid solutions. Just be careful what you ask for! (I upgraded to Godot 3.1.1  and needed to redo all my UI to fix a tiny bug with one slider.)</li>
<li><strong>Always update to the latest version of Godot.</strong> It really works better, and often clears up hard-to-fix bugs.</li>
<li><strong>Make friends on Twitter.</strong> You never know who will like, follow, comment, download your game, and - critically - help often comes from those who we least expect it from.</li>
</ul>
<p>Finally, I want to personally thank everyone who helped me with the project - you know who you are. Without your help, coaching, support, and mentorship, I would never actually finished the game.</p></li>
          <li class="list-group-item text-right">
            <div class="btn-group">
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/eman-quest-retrospective.html#disqus_thread" title="comments">
                <span class="glyphicon glyphicon-comment" data-disqus-identifier="eman-quest-retrospective">
                </span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/eman-quest-retrospective.html" title="permanent link">
                <span class="glyphicon glyphicon-link"></span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/eman-quest-retrospective.html" title="read more">
                <span class="glyphicon glyphicon-plus"></span></a>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <div class="panel panel-primary">
      <div class="panel-heading panel-title">
        <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a> - <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month06">June</a>
      <a class="accordion-toggle" data-toggle="collapse" 
        title="toggle folding"
        href="#collapseArticle4">
        <span class="pull-right badge">
          #12
        </span>
      </a>
      </div>

      <div class="panel-body hidden">

      </div>

      <ul class="list-group">
        <a href="https://nightblade9.github.io/godot-gamedev/2019/capture-in-game-screenshots-in-godot.html">
          <li class="list-group-item">
            <h1>Capture In-Game Screenshots in Godot</h1>
          </li>
        </a>
        <div class="collapse in"
          id="collapseArticle4">
          <li class="list-group-item">
              <span id="article_info">
    <a class="label label-primary"
      href="https://nightblade9.github.io/godot-gamedev/category/technical.html">Technical</a>
      <b> · </b>
        <a class="label label-primary"
          href="https://nightblade9.github.io/godot-gamedev/tag/godot.html">Godot</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month06">06</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month06">11</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="https://nightblade9.github.io/godot-gamedev/author/nightblade.html">nightblade</a>
  </span>

            <a class="pull-right" href="https://nightblade9.github.io/godot-gamedev/2019/capture-in-game-screenshots-in-godot.html">
              </a>
          </li>
          <li class="list-group-item"><p><img alt="Animation of a game saving, with a screenshot appearing on the save screen" src="https://i.imgur.com/OlsyPli.gif"></p>
<p>Godot allows you to capture in-game screen-shots, without the use of any plugins/addons. However, I couldn't find a complete, step-by-step guide to do this, without relying on any specific nodes being instantiated in your scene.</p>
<p>You can follow these steps. I tested these on Godot 3.0.6. Some of the code originated in a thread that mentioned that "you need this prior to Godot 3.1," but through testing, I eventually removed all unnecessary code. I can confirm that this sample works, because I implemented it in <a href="https://twitter.com/search?q=%23EmanQuest">Eman Quest</a>.</p>
<h1>Saving Screenshots</h1>
<p>Godot provides a rather straight-forward API for saving a screenshot:</p>
<div class="highlight"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">screenshot_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;user://screenshot-test.png&quot;</span><span class="w"></span>

<span class="c1"># Retrieve the captured image</span><span class="w"></span>
<span class="k">var</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_tree</span><span class="p">()</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span><span class="o">.</span><span class="n">get_texture</span><span class="p">()</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="w"></span>

<span class="c1"># Flip it on the y-axis (because it&#39;s flipped)</span><span class="w"></span>
<span class="n">image</span><span class="o">.</span><span class="n">flip_y</span><span class="p">()</span><span class="w"></span>

<span class="n">image</span><span class="o">.</span><span class="n">save_png</span><span class="p">(</span><span class="n">screenshot_path</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>This saves a screenshot into a file called <code>screenshot-test.png</code>, under the user space; on Windows, that's something like <code>C:\Users\CURRENTLY_LOGGED_IN_USER\AppData\Roaming\Godot\app_userdata\Eman Quest\screenshot-save0.png</code>, where <code>CURRENTLY_LOGGED_IN_USER</code> is your user name (eg. <code>nightblade</code>).</p>
<h1>Loading Screenshots</h1>
<p>Loading screenshots proves more complicated:</p>
<ul>
<li>To load the data, you can use <code>image.load_png_from_buffer</code>, but it takes a <code>PoolByteArray</code> - not something you can load with a call to <code>preload("res://...")</code>. This requires using the <code>File</code> API.</li>
<li>To set the texture onto a sprite, you cannot simply assign it to an <code>Image</code> instance; instead, you need to create and initialize an <code>ImageTexture</code> instance.</li>
</ul>
<p>After we sort through these issues, we end up with code like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="o">.</span><span class="n">new</span><span class="p">()</span><span class="w"></span>
<span class="n">file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;user://screenshot-test.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="o">.</span><span class="n">READ</span><span class="p">)</span><span class="w"></span>
<span class="k">var</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">.</span><span class="n">get_buffer</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">get_len</span><span class="p">())</span><span class="w"></span>
<span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span><span class="w"></span>

<span class="k">var</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">()</span><span class="w"></span>
<span class="n">image</span><span class="o">.</span><span class="n">load_png_from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span><span class="w"></span>

<span class="k">var</span><span class="w"> </span><span class="n">image_texture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImageTexture</span><span class="o">.</span><span class="n">new</span><span class="p">()</span><span class="w"></span>
<span class="n">image_texture</span><span class="o">.</span><span class="n">create_from_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="w"></span>

<span class="n">sprite</span><span class="o">.</span><span class="n">texture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image_texture</span><span class="w"></span>
</code></pre></div>

<p>This loads the PNG file <code>screenshot-test.png</code> from the user-space into an <code>Image</code>, wraps it into an <code>ImageTexture</code>, and assigns it to some <code>Sprite</code> instance</p>
<h1>Crop and Scale</h1>
<p>Since we loaded our PNG into a <code>Sprite</code>, we can execute other operations on it:</p>
<ul>
<li>You can set the <code>region_rect</code> properties (through code or through the editor) to crop the image</li>
<li>You can set the <code>scale</code> to create a thumbnail of the image</li>
<li>You can apply effects, colourization, etc.</li>
</ul>
<p>This affords a lot of interesting use-cases, such as creating a thumbnail of the in-game screen per save-game (my personal use case).</p></li>
          <li class="list-group-item text-right">
            <div class="btn-group">
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/capture-in-game-screenshots-in-godot.html#disqus_thread" title="comments">
                <span class="glyphicon glyphicon-comment" data-disqus-identifier="capture-in-game-screenshots-in-godot">
                </span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/capture-in-game-screenshots-in-godot.html" title="permanent link">
                <span class="glyphicon glyphicon-link"></span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/capture-in-game-screenshots-in-godot.html" title="read more">
                <span class="glyphicon glyphicon-plus"></span></a>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <div class="panel panel-primary">
      <div class="panel-heading panel-title">
        <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a> - <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month05">May</a>
      <a class="accordion-toggle" data-toggle="collapse" 
        title="toggle folding"
        href="#collapseArticle5">
        <span class="pull-right badge">
          #11
        </span>
      </a>
      </div>

      <div class="panel-body hidden">

      </div>

      <ul class="list-group">
        <a href="https://nightblade9.github.io/godot-gamedev/2019/getting-started-with-unit-and-integration-testing-in-godot.html">
          <li class="list-group-item">
            <h1>Getting Started with Unit and Integration Testing in Godot</h1>
          </li>
        </a>
        <div class="collapse in"
          id="collapseArticle5">
          <li class="list-group-item">
              <span id="article_info">
    <a class="label label-primary"
      href="https://nightblade9.github.io/godot-gamedev/category/game-development.html">Game Development</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month05">05</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month05">13</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="https://nightblade9.github.io/godot-gamedev/author/nightblade.html">nightblade</a>
  </span>

            <a class="pull-right" href="https://nightblade9.github.io/godot-gamedev/2019/getting-started-with-unit-and-integration-testing-in-godot.html">
              </a>
          </li>
          <li class="list-group-item"><p><img alt="screenshot with code on top" src="https://i.imgur.com/F3hoasj.jpg">
(Image credit: <a href="https://godotengine.org/article/tests-needed-godot-2-1-4-beta">Godot blog</a>)</p>
<p>Godot affords the possibility of unit and integration testing <code>gdscript</code> code via the GUT extension. If you're getting started with unit/integrated testing (collectively "automated testing") or Godot, and interested in what automated testing can do for you, read on.</p>
<h1>What is Automated Testing and Why do I Care?</h1>
<p>Your game contains lots of logic. When you make changes, you need to re-test that everything that worked before, still works (nothing broke). As you find and fix bugs, and get into corner-cases of your game (eg. testing the entire play-through), manually re-testing everything becomes more and more time-consuming.</p>
<p>Automated testing provides a solution to these problems: what if you could <em>write code</em> that would test your game code? What if that code could run through all the necessary scenarios of your game in a matter of minutes, or seconds? What if you could run the tests after every single change, and be sure that you never broke anything?</p>
<p>Automated testing provides exactly this benefit. You write test-code that tests your "production" code. Unit tests, which test very small levels of functionality, run in in a matter of milliseconds; integration tests, which typically test workflows (fight monster, get experience, level up, spend skill points) take longer, but allow you to automate workflows.</p>
<p>Finally, any experienced developer with automated testing will agree: the <em>mindset change</em> you get from automated testing is unparalleled. Not only can you test <em>every single line of code</em> you change, making sure it works, but you can also make bigger, riskier changes, because of your safety-net of unit tests. You can actually go faster, and make bigger changes, with your safety net of automated tests.</p>
<h1>The Downside of Automated Testing</h1>
<p>Like many things, automated testing is a trade-off. Unit testing is the de-facto standard now in the software industry, so we happily accept the downsides in exchange for the wealth of benefits we receive. Regardless, here they are:</p>
<ul>
<li><strong>Automated tests take time to write.</strong> You could be writing production code instead! For very tiny projects, proof-of-concepts, prototypes, and simple applications, you may not care about testing at all.</li>
<li><strong>Writing testable code changes your code.</strong> Your code ends up being more decoupled, more isolated, and more testable. While these are all good software engineering practices, some communities look down on this.</li>
<li><strong>Flaky tests.</strong> Poorly-written integration tests (and sometimes unit tests) can fail on and off, sometimes for reasons not related to your change. (As you become more experienced with testing, you learn how to write less-flaky tests.)</li>
<li><strong>Major refactoring is expensive.</strong> If you decide to change a significant amount of code - like moving a method from one place to another, or significantly changing functionality - you now need to pay the cost of updating lots of broken tests.</li>
</ul>
<p>Overall, the benefits heavily outweigh the costs. There's really no reason not to write automated tests!</p>
<h1>Unit vs. Integration Testing</h1>
<p>We touched earlier on the difference between unit and integration tests. Typically, unit tests test a single method or class. The hallmark of unit tests, is that they don't depend on anything external - they don't touch the database, the file-system, they don't make web-service calls, etc. Because of this, unit tests tend to be extremely stable and robust, and run in sub-millisecond time. A large suite of thousands of unit tests may run in just a few seconds.</p>
<p>However, unit tests, by nature, test only a very limited set of functionality. Integration tests, in contrast, typically test more complex scenarios, and/or workflows.</p>
<p>Imagine we wrote an RPG-style game. The user can battle monsters; on victory, he receives experience points, and can use those to invest in learning new skills.  If we structured this as typical domain-driven classes (such as <code>Player</code>, <code>Monster</code>, etc.) we might write unit tests such as:</p>
<ul>
<li><code>Player.attack(target)</code> damages the target</li>
<li><code>Player.hurt(damage)</code> decreases health</li>
<li><code>Player.hurt(damage)</code> throws an error if damage is less than zero (programmer bug)</li>
</ul>
<p>These are all class/object/method-level tests. In contrast, we might write integration tests such as:</p>
<ul>
<li>When a player fights an enemy and defeats it, the player receives experience points</li>
<li>When the player receives enough XP, they level up and gain skill points</li>
<li>When monsters defeat the player, the game reaches a "game over" state</li>
</ul>
<p>These tests, by nature, work with a larger set of code - so you can test more things. But, they can also be more fragile - if something breaks in the workflow (damage calculation broken? Level-up calculation broken? Skill-points UI broken?), the test can fail.</p>
<h1>Godot with  Mono vs. GDscript</h1>
<p>Godot provides two options for unit testing, depending on whether you prefer C# or GDscript.</p>
<p>If you prefer C#, create your project as a Godot + Mono project, and write as much logic as possible in the C# code. This way, you can use the "usual" set of C# testing tools (NUnit, Moq, etc.) and everything Just Works.</p>
<p>If you can't, won't, or prefer GDscript, you can use the GUT extension. (GUT stands for Godot Unit Test.)</p>
<h1>Getting Started Testing (with Gut)</h1>
<p>The <a href="https://github.com/bitwes/Gut">GUT project page on GitHub</a> provides a <a href="https://github.com/bitwes/Gut/wiki/Install">detailed explanation of getting started</a>, which I won't repeat here. Install GUT in your project, create a new scene with the <code>Gut</code> object, and you're ready to go.</p>
<p>Instead, I'll focus on getting started testing: what do you test? Assuming you have an existing project with an extensive code-base and zero unit tests, what do you do?</p>
<p>Fundamentally, you need to start doing two things:</p>
<p>1) Refactor your code to make it more testable
2) Write tests for any new code</p>
<p>We didn't really touch on testable code in any depth. The short version is: write simple classes with simple methods, and avoid dependencies on any external "things." For example, if your <code>Player.damage</code> class depends on a <code>Globals.battle_difficulty</code> multiplier, accept it as a passed-in value instead of referencing the <code>Globals</code> script. Change this:</p>
<div class="highlight"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="n">player</span><span class="o">.</span><span class="n">gd</span><span class="w"></span>
<span class="k">class</span><span class="w"> </span><span class="n">damage</span><span class="p">(</span><span class="n">target</span><span class="p">):</span><span class="w"></span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">total_defense</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="o">.</span><span class="n">defense</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Globals</span><span class="o">.</span><span class="n">battle_difficulty</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">target</span><span class="o">.</span><span class="n">current_health</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">strength</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">total_defense</span><span class="w"></span>

<span class="o">//</span><span class="w"> </span><span class="n">Elsewhere</span><span class="w"></span>
<span class="n">player</span><span class="o">.</span><span class="n">damage</span><span class="p">(</span><span class="n">selected_monster</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>To this:</p>
<div class="highlight"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="n">player</span><span class="o">.</span><span class="n">gd</span><span class="w"></span>
<span class="k">class</span><span class="w"> </span><span class="n">damage</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">battle_difficulty</span><span class="p">):</span><span class="w"></span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">total_defense</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="o">.</span><span class="n">defense</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">battle_difficulty</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">target</span><span class="o">.</span><span class="n">current_health</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">strength</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">total_defense</span><span class="w"></span>

<span class="o">//</span><span class="w"> </span><span class="n">Elsewhere</span><span class="w"></span>
<span class="n">player</span><span class="o">.</span><span class="n">damage</span><span class="p">(</span><span class="n">selected_monster</span><span class="p">,</span><span class="w"> </span><span class="n">Globals</span><span class="o">.</span><span class="n">battle_difficulty</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>While the code is functionally equivalent, the latter is far more testable: you can pass in whatever value of <code>battle_difficutly</code> you want in your tests, even invalid values like -3! In fact, this is the kind of functionality you want to unit-test: in addition to making sure it works with a correct difficulty, you can test that it fails appropriately (eg. throws an error or returns 0) with an invalid value - something you can't easily test through the actual game.</p>
<h1>In Conclusion</h1>
<p>We covered a lot of ground in this article.  In summary:</p>
<ul>
<li>We talked about automated testing, and why we care about it at all</li>
<li>We looked at some of the benefits and advantages of unit-testing</li>
<li>We touched on some of the downsides, most of which are not really disadvantageous</li>
<li>We looked at unit vs. integration tests, and one way to define integration tests as workflows</li>
<li>We covered testing with C# (in brief) vs. testing GDscript with Godot</li>
<li>We looked at writing a few simple unit tests on a player class, and making code more testable</li>
</ul>
<p>I hope this post benefited you, and convinced you to at least try unit testing! Please let me know your feedback <a href="https://twitter.com/nightblade99">on Twitter</a> - whether you decide to try testing, what you didn't understand, and what kind of topics you would like me to cover in future articles on Godot and testing.</p></li>
          <li class="list-group-item text-right">
            <div class="btn-group">
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/getting-started-with-unit-and-integration-testing-in-godot.html#disqus_thread" title="comments">
                <span class="glyphicon glyphicon-comment" data-disqus-identifier="getting-started-with-unit-and-integration-testing-in-godot">
                </span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/getting-started-with-unit-and-integration-testing-in-godot.html" title="permanent link">
                <span class="glyphicon glyphicon-link"></span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/getting-started-with-unit-and-integration-testing-in-godot.html" title="read more">
                <span class="glyphicon glyphicon-plus"></span></a>
            </div>
          </li>
        </div>
      </ul>
    </div>
  </div>
        </div>

        <div class="row">
      <ul class="pagination">

        <li>
            <a href="https://nightblade9.github.io/godot-gamedev/index.html">&laquo;</a>
        </li>

        <li>
          <a href="https://nightblade9.github.io/godot-gamedev/index.html">1<span class="sr-only">(current)</span></a>
        </li>
        <li class="active">
          <a>2<span class="sr-only">(current)</span></a>
        </li>
        <li>
          <a href="https://nightblade9.github.io/godot-gamedev/index3.html">3<span class="sr-only">(current)</span></a>
        </li>
        <li>
          <a href="https://nightblade9.github.io/godot-gamedev/index4.html">4<span class="sr-only">(current)</span></a>
        </li>

        <li>
          <a href="index3.html">&raquo;</a>
        </li>

    </ul>

        </div>

      </div>

      <div class="col-md-2">
      </div>
    </div>


  </div>

    <nav id="footer" class="navbar navbar-default">
    <div class="container">
        <p id="footer-text" class="navbar-text text-center">
          Copyright &copy; <a href="https://twitter.com/nightblade99">NightBlade</a>, 2018+. All rights reserved.
        </p>
      </div>
    </div>
  </nav>


</body>
</html>
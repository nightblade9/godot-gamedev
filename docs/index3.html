
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="Godot Game Development">
    <meta name="author" content="nightblade">

        <title>Godot Game Development</title>


    <!-- Bootstrap core CSS -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">


    <link rel="stylesheet" href="https://nightblade9.github.io/godot-gamedev/theme/css/main.css">

    <link rel="stylesheet" href="https://nightblade9.github.io/godot-gamedev/theme/css/solarized-light.css">


    <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

  
</head>

<body>
  <div class="container" id="wrap">
      <nav id="navbar" class="navbar navbar-default" role="navigation">
    <div class="container">

      <!--navbar-header-->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
  
        <a class="navbar-brand" href="https://nightblade9.github.io/godot-gamedev">Home</a>

        <p class='navbar-brand'>|</p>

          <a class="navbar-brand" href="https://nightblade9.github.io/godot-gamedev/pages/about.html">About</a>

        <p class='navbar-brand'>|</p>

          <a class="navbar-brand" href="https://www.deengames.com">Deen Games</a>
      </div> <!--navbar-header-->

      <!-- Search Box -->

      <!--Menuitems, collapable-->
      <div class="collapse navbar-collapse" id="navbar-collapse">
        <ul class="nav navbar-nav navbar-right" id="menuitem-list">
        </ul>
      </div><!-- /.navbar-collapse -->

    </div> <!--container-->
  </nav>

    
    <div class="list-group">
      </strong>Categories:
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/devlog.html">Devlog</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/game-design.html">Game Design</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/game-development.html">Game Development</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/news.html">News</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/retrospective.html">Retrospective</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/technical.html">Technical</a> |</span>
        <span><a href="https://nightblade9.github.io/godot-gamedev/category/web-development.html">Web Development</a> |</span>
    </div>

    <div class="container">
      <div class="col-md-2">
      </div>

      <div class="col-md-8">
        <div class="row">
          
        </div>

        <div class="row">

  <!--<script type="text/javascript">-->
    <!--/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */-->
    <!--var disqus_shortname = 'yuex'; // required: replace example with your forum shortname-->

    <!--/* * * DON'T EDIT BELOW THIS LINE * * */-->
    <!--(function () {-->
    <!--var s = document.createElement('script'); s.async = true;-->
    <!--s.type = 'text/javascript';-->
    <!--s.src = '//' + disqus_shortname + '.disqus.com/count.js';-->
    <!--(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);-->
    <!--}());-->
  <!--</script>-->

  <div id="home_article_list" class="panel-group" id="accordion">

    <div class="panel panel-primary">
      <div class="panel-heading panel-title">
        <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a> - <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month04">April</a>
      <a class="accordion-toggle" data-toggle="collapse" 
        title="toggle folding"
        href="#collapseArticle1">
        <span class="pull-right badge">
          #10
        </span>
      </a>
      </div>

      <div class="panel-body hidden">

      </div>

      <ul class="list-group">
        <a href="https://nightblade9.github.io/godot-gamedev/2019/godot-game-crashes-on-startup-logo-showshides.html">
          <li class="list-group-item">
            <h1>Godot Game Crashes On Startup, Logo Shows/Hides</h1>
          </li>
        </a>
        <div class="collapse in"
          id="collapseArticle1">
          <li class="list-group-item">
              <span id="article_info">
    <a class="label label-primary"
      href="https://nightblade9.github.io/godot-gamedev/category/technical.html">Technical</a>
      <b> · </b>
        <a class="label label-primary"
          href="https://nightblade9.github.io/godot-gamedev/tag/godot.html">Godot</a>
        <a class="label label-primary"
          href="https://nightblade9.github.io/godot-gamedev/tag/android.html">Android</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month04">04</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month04">29</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="https://nightblade9.github.io/godot-gamedev/author/nightblade.html">nightblade</a>
  </span>

            <a class="pull-right" href="https://nightblade9.github.io/godot-gamedev/2019/godot-game-crashes-on-startup-logo-showshides.html">
              </a>
          </li>
          <li class="list-group-item"><p>I recently rebuilt a small app/game using Godot. For reference, the game contained one core loop, and took about four hours to build (from scratch). I reused all of the assets from the previous version of the game (audio and graphics), which took the bulk of development time on the original.</p>
<p>The game built and ran flawlessly in Godot on Windows. As soon as I ran it on Android, the game briefly showed the Godot loading logo for ~100ms, then it disappeared, then reappeared/disappeared around four times (you can see the original issue I opened about on GitHub, <a href="https://github.com/godotengine/godot/issues/27583">here</a>).</p>
<p>The root cause of all this was multiple resources preloading the same script. I had a scene that preloaded <code>HelperScript.gd</code> and then <code>Second.tscn</code>; but <code>Second.tscn</code> also preloaded <code>HelperScript.gd</code>, causing the crash.</p>
<p>I found three different ways to address this problem:</p>
<ul>
<li><strong>Use singletons.</strong> Instead of preloading <code>HelperScript.gd</code> everywhere, I simply added it to the list of auto-loaded singletons in Godot. Problem solved. (This solution also makes sense, because I needed the same common method from <code>HelperScript.gd</code>.)</li>
<li><strong>Use <code>load</code> instead of <code>preload</code>.</strong> This makes me think <code>preload</code> is bugged; calling <code>load</code> succeeds without any issues. Obviously, this has performance implications - you may <em>want</em> to preload your entire game at startup time.</li>
<li><strong>Refactor.</strong> In my case, I needed a common function from a shared script. What if I used the same file, but two different functions? Perhaps I could split <code>HelperScript.gd</code> into two different scripts, and just load what I need instead.</li>
</ul>
<p>If you find your Godot game crashes on startup without explanation, maybe this is something you can investigate. (Failing that, go for a <code>git bisect</code> and try to isolate the commit that broke everything.)</p></li>
          <li class="list-group-item text-right">
            <div class="btn-group">
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/godot-game-crashes-on-startup-logo-showshides.html#disqus_thread" title="comments">
                <span class="glyphicon glyphicon-comment" data-disqus-identifier="godot-game-crashes-on-startup-logo-showshides">
                </span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/godot-game-crashes-on-startup-logo-showshides.html" title="permanent link">
                <span class="glyphicon glyphicon-link"></span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/godot-game-crashes-on-startup-logo-showshides.html" title="read more">
                <span class="glyphicon glyphicon-plus"></span></a>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <div class="panel panel-primary">
      <div class="panel-heading panel-title">
        <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a> - <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month03">March</a>
      <a class="accordion-toggle" data-toggle="collapse" 
        title="toggle folding"
        href="#collapseArticle2">
        <span class="pull-right badge">
          #9
        </span>
      </a>
      </div>

      <div class="panel-body hidden">

      </div>

      <ul class="list-group">
        <a href="https://nightblade9.github.io/godot-gamedev/2019/text-rendering-performance-check-for-a-reactjs-ascii-roguelike.html">
          <li class="list-group-item">
            <h1>Text Rendering Performance Check for a ReactJS ASCII Roguelike</h1>
          </li>
        </a>
        <div class="collapse in"
          id="collapseArticle2">
          <li class="list-group-item">
              <span id="article_info">
    <a class="label label-primary"
      href="https://nightblade9.github.io/godot-gamedev/category/technical.html">Technical</a>
      <b> · </b>
        <a class="label label-primary"
          href="https://nightblade9.github.io/godot-gamedev/tag/reactjs.html">ReactJS</a>
        <a class="label label-primary"
          href="https://nightblade9.github.io/godot-gamedev/tag/roguelike.html">Roguelike</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019">2019</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month03">03</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2019Month03">19</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="https://nightblade9.github.io/godot-gamedev/author/nightblade.html">nightblade</a>
  </span>

            <a class="pull-right" href="https://nightblade9.github.io/godot-gamedev/2019/text-rendering-performance-check-for-a-reactjs-ascii-roguelike.html">
              </a>
          </li>
          <li class="list-group-item"><p><img alt="image" src="https://i.imgur.com/bMgMS3E.gif"></p>
<p>Recently, I was tasked with learning ReactJS (or just "React"). So, I made the most obvious choice possible: I decided to write an ASCII roguelike, which uses React as the front-end.</p>
<h2>Why an ASCII Roguelike?</h2>
<p>Why? For several, obvious reasons:</p>
<ul>
<li>I have very limited time to work on this; perhaps as little as one hour a day, or less.</li>
<li>ASCII roguelikes require little beyond a good monospace font -- no complex graphics, very simple animations</li>
<li>I enjoy creating roguelikes. It's fun. Fun motivates me to work on this, which fuels my learning.</li>
<li>Having created several (failed/incomplete) roguelikes in the past, I know how to code them. I don't have to think too hard about level generation algorithms, line-of-sight (or area-of-sight) lighting, etc. so I can focus on the technology.</li>
</ul>
<p>I set out to create, in my mind, the first step of any text roguelike: draw text on the screen <em>really fast</em> and see how it performs. HTML should render at lightning-speed in my modern browser, right?</p>
<p>Wrong.</p>
<h2>The Simplest Possible Performance Test</h2>
<p>React is just a front-end technology; it doesn't dictate how I should structure my HTML. With that in mind, I set out to answer two questions:</p>
<ul>
<li>What kind of performance can I expect with my roguelike?</li>
<li>What factors affect performance? Does changing the font, applying colour (or not), using nested <code>div</code> tags vs. <code>span</code> tags, etc. make any difference?</li>
</ul>
<p>In brief, the answer to question #2 ended up being "no." Performance bottlenecks on something else entirely; none of those changes make any significant difference.</p>
<p>I wrote a little Javascript that tests exactly what I want:</p>
<ul>
<li>Define dimensions of the screen. In this case, 50x16 tiles.</li>
<li>Create a <code>div</code> tag for each tile. Style it appropriately (eg. width/height big enough to fit any character)</li>
<li>Very frequently (like, 60 times per second), update each tile's display to a random character with a random colour.</li>
</ul>
<p>You can see the code, more or less (with FPS counting),  <a href="https://github.com/nightblade9/space-marine-junaid/blob/master/prototypes/1-dom-performance/index.html">here</a>.  It's simple, and to the point.</p>
<h2>The Results</h2>
<p>In a word: abysmal! On my fairly beefy dev machine (lots of RAM, good CPU, mediocre GPU), it renders at a measly 6-7FPS. You can see the results <a href="https://twitter.com/nightblade99/status/1098278413935280128">in this tweet</a>.</p>
<p>As I mentioned earlier, I tried several variations; none of them improve performance, at all. The core of it comes down to a call to set the character itself. Pseudocode:</p>
<div class="highlight"><pre><span></span><code><span class="nf">var</span><span class="w"> </span><span class="k">character</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="nf">var</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="nf">var</span><span class="w"> </span><span class="n">tile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">window</span><span class="p">.</span><span class="n">tiles</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="n">tile</span><span class="p">.</span><span class="n">innerText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">character</span><span class="w"></span>
</code></pre></div>

<p>It turns out that browsers, even modern ones, even on beefy hardware, are <em>really, really slow</em> when you set <code>innerText</code>. The only alternative - using <code>innerHTML</code> -- is slower, and probably broken on Internet Explorer.</p>
<h3>The Conclusion</h3>
<p>For an ASCII roguelike without too much going on, 6FPS is probably enough. If I really cared about performance, I could switch to canvas-rendering and a bitmap font (lots of work and not sure how it works with React), or using images - either images of text, or real images.</p>
<p>For me, the goal is to learn ReactJS, so I plan to continue forward with this as-is, without major surgery.</p></li>
          <li class="list-group-item text-right">
            <div class="btn-group">
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/text-rendering-performance-check-for-a-reactjs-ascii-roguelike.html#disqus_thread" title="comments">
                <span class="glyphicon glyphicon-comment" data-disqus-identifier="text-rendering-performance-check-for-a-reactjs-ascii-roguelike">
                </span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/text-rendering-performance-check-for-a-reactjs-ascii-roguelike.html" title="permanent link">
                <span class="glyphicon glyphicon-link"></span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2019/text-rendering-performance-check-for-a-reactjs-ascii-roguelike.html" title="read more">
                <span class="glyphicon glyphicon-plus"></span></a>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <div class="panel panel-primary">
      <div class="panel-heading panel-title">
        <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018">2018</a> - <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018Month10">October</a>
      <a class="accordion-toggle" data-toggle="collapse" 
        title="toggle folding"
        href="#collapseArticle3">
        <span class="pull-right badge">
          #8
        </span>
      </a>
      </div>

      <div class="panel-body hidden">

      </div>

      <ul class="list-group">
        <a href="https://nightblade9.github.io/godot-gamedev/2018/creating-tilemaps-with-tile-entities-in-godot.html">
          <li class="list-group-item">
            <h1>Creating Tilemaps with Tile Entities in Godot</h1>
          </li>
        </a>
        <div class="collapse in"
          id="collapseArticle3">
          <li class="list-group-item">
              <span id="article_info">
    <a class="label label-primary"
      href="https://nightblade9.github.io/godot-gamedev/category/technical.html">Technical</a>
      <b> · </b>
        <a class="label label-primary"
          href="https://nightblade9.github.io/godot-gamedev/tag/godot.html">Godot</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018">2018</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018Month10">10</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018Month10">02</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="https://nightblade9.github.io/godot-gamedev/author/nightblade.html">nightblade</a>
  </span>

            <a class="pull-right" href="https://nightblade9.github.io/godot-gamedev/2018/creating-tilemaps-with-tile-entities-in-godot.html">
              </a>
          </li>
          <li class="list-group-item"><p>Godot's tile editor provides you with the ability to quickly make 2D tile-maps, similar to RPG Maker. This makes it easy to design and tweak maps. But can we take it a step further? Can we, in fact, use the tilemap editor to create <em>functioning entities</em> -- making it a domain-specific editor for our specific game?</p>
<p>We can. This post walks through a lightning-quick method you can use.</p>
<h2>The Core Idea</h2>
<p>Godot's <code>Tilemap</code> entities are simple. They're essentially a reference to a tileset (graphic with all your tiles on it), and one or more layers of those tiles drawn on a grid.  In Godot, tilemaps are all about presentation.</p>
<p>What if you want to add functionality though? Imagine you're creating a 2D adventure or RPG (like, hmm, <a href="https://play.google.com/store/apps/details?id=com.deengames.eidisland">Eid Island</a> maybe?), and you want to be able to draw enemies on the map. Or trees you can chop down, coins you can pick up, or anything else.</p>
<p>By itself, Godot doesn't provide a way to do this. However, I asked around on Discord, and checked some issues on GitHub about this; a definitive, simple approach appeared, something like a best-practice. How? Easy.</p>
<ul>
<li>Define your tilesets as usual, including objects</li>
<li>Draw them in as many layers as you like, as usual</li>
<li>At runtime, iterate over the tiles, replacing the object ones with real entities (<code>Scene</code> instances)</li>
</ul>
<h2>The Secet Sauce: Swapping Tiles for Entities</h2>
<p>Godot makes this process quite easy. As a pre-requisite, I would recommend:</p>
<ul>
<li>All your tiles have proper, uniquely-identifying names (like <code>Tree</code> or <code>Plain Water</code>)</li>
<li>You create entities for everything you want to replace, such as a <code>Tree</code> scene (subclasses <code>Node2D</code>, has a <code>Sprite</code>, script, etc.)</li>
<li>You map the two. I use a dictionary such as: <code>var entity_tiles = { "Tree": preload("res://Scenes/Entities/Tree.tscn") }</code></li>
</ul>
<p>With this in place, we simply iterate over the tiles and -- if the name appears in our dictionary -- replace the tile with its corresponding entity. Here's <a href="https://github.com/nightblade9/eid-island/blob/7ec52d4a9b33feb87d6e05be0908e449cb1fa330/source/Scripts/MapCreator.gd#L48">an early reference implementation</a> in Eid Island. </p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">map</span><span class="w"> </span><span class="p">(</span><span class="n">eg</span><span class="p">.</span><span class="w"> </span><span class="n">trees</span><span class="p">).</span><span class="w"> </span><span class="n">Remove</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">replace</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="k">with</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="nc">real</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="p">(</span><span class="n">scenes</span><span class="p">)</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="p">(</span><span class="n">attach</span><span class="w"> </span><span class="n">scripts</span><span class="p">)</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">them</span><span class="p">.</span><span class="w"></span>
<span class="n">func</span><span class="w"> </span><span class="n">_populate_entities</span><span class="p">(</span><span class="k">map</span><span class="p">)</span><span class="err">:</span><span class="w"></span>
<span class="w">    </span><span class="nf">var</span><span class="w"> </span><span class="n">possible_tilemaps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">map</span><span class="p">.</span><span class="n">get_children</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">tile_map</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">possible_tilemaps</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">tile_map</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nl">TileMap</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nf">var</span><span class="w"> </span><span class="n">tile_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tile_map</span><span class="p">.</span><span class="n">tile_set</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tile_map</span><span class="p">.</span><span class="n">get_used_cells</span><span class="p">()</span><span class="err">:</span><span class="w"></span>
<span class="w">                </span><span class="nf">var</span><span class="w"> </span><span class="n">tile_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tile_map</span><span class="p">.</span><span class="n">get_cellv</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="nf">var</span><span class="w"> </span><span class="n">tile_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tile_set</span><span class="p">.</span><span class="n">tile_get_name</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">entity_tiles</span><span class="p">.</span><span class="n">has</span><span class="p">(</span><span class="n">tile_name</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="n">Spawn</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">replace</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="w">                    </span><span class="nf">var</span><span class="w"> </span><span class="n">scene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entity_tiles</span><span class="o">[</span><span class="n">tile_name</span><span class="o">]</span><span class="w"></span>
<span class="w">                    </span><span class="nf">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scene</span><span class="p">.</span><span class="n">instance</span><span class="p">()</span><span class="w"></span>
<span class="w">                    </span><span class="k">map</span><span class="p">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="n">instance</span><span class="p">.</span><span class="k">position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cell</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Globals</span><span class="p">.</span><span class="n">TILE_WIDTH</span><span class="w"></span>
<span class="w">                    </span><span class="n">instance</span><span class="p">.</span><span class="k">position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cell</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Globals</span><span class="p">.</span><span class="n">TILE_HEIGHT</span><span class="w"></span>

<span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="n">Remove</span><span class="w"> </span><span class="n">tile</span><span class="w"></span>
<span class="w">                    </span><span class="n">tile_map</span><span class="p">.</span><span class="n">set_cellv</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p><code>Globals.TILE_WIDTH</code> and <code>TILE_HEIGHT</code> refer to the (fixed) tile size; you can, alternatively, use the tileset/tilemap to get the cell size, or use the entity size as a reference (although the entity should be exactly one tile size for that to work).</p>
<p>With this in place, you can quickly and easily create levels with real functionality from simple tilesets.</p>
<h2>Next Steps</h2>
<p>One obvious missing piece of functionality is customization. What if my tile is, say, a door that warps somewhere, and I want to specify the destination properties when I draw the tile? How can I do that?</p>
<p>Unfortunately, I don't know the answer yet. As far as I know, Godot doesn't allow you to add additional variables/properties to the tile itself. Perhaps you could store the data elsewhere, such as a separate dictionary mapping entity/coordinates to custom data.</p>
<p>If you know how to solve this latter problem, drop us a note <a href="https://github.com/nightblade99">on Twitter</a> or in the Godot Discord chat so we can use it too!</p></li>
          <li class="list-group-item text-right">
            <div class="btn-group">
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2018/creating-tilemaps-with-tile-entities-in-godot.html#disqus_thread" title="comments">
                <span class="glyphicon glyphicon-comment" data-disqus-identifier="creating-tilemaps-with-tile-entities-in-godot">
                </span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2018/creating-tilemaps-with-tile-entities-in-godot.html" title="permanent link">
                <span class="glyphicon glyphicon-link"></span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2018/creating-tilemaps-with-tile-entities-in-godot.html" title="read more">
                <span class="glyphicon glyphicon-plus"></span></a>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <div class="panel panel-primary">
      <div class="panel-heading panel-title">
        <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018">2018</a> - <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018Month09">September</a>
      <a class="accordion-toggle" data-toggle="collapse" 
        title="toggle folding"
        href="#collapseArticle4">
        <span class="pull-right badge">
          #7
        </span>
      </a>
      </div>

      <div class="panel-body hidden">

      </div>

      <ul class="list-group">
        <a href="https://nightblade9.github.io/godot-gamedev/2018/eman-quest-restrospective-a-procedural-rpg-in-a-month.html">
          <li class="list-group-item">
            <h1>Eman Quest Restrospective: A Procedural RPG in a Month</h1>
          </li>
        </a>
        <div class="collapse in"
          id="collapseArticle4">
          <li class="list-group-item">
              <span id="article_info">
    <a class="label label-primary"
      href="https://nightblade9.github.io/godot-gamedev/category/devlog.html">Devlog</a>
      <b> · </b>
        <a class="label label-primary"
          href="https://nightblade9.github.io/godot-gamedev/tag/retrospective.html">Retrospective</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018">2018</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018Month09">09</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018Month09">28</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="https://nightblade9.github.io/godot-gamedev/author/nightblade.html">nightblade</a>
  </span>

            <a class="pull-right" href="https://nightblade9.github.io/godot-gamedev/2018/eman-quest-restrospective-a-procedural-rpg-in-a-month.html">
              </a>
          </li>
          <li class="list-group-item"><p><img alt="screenshot of a hero facing a boss" src="https://i.imgur.com/Nu9doZ9.jpg"></p>
<p>This month, I set out with a very specific goal: create a 2D procedurally-generated RPG; something I've never heard of (or done before). Although I ran out of time, I plan to devote another month to the game. This retrospective discusses the good, the bad, and the work ahead of us.</p>
<h2>Goal: What is a Procedurally-Generated RPG?</h2>
<p>I grew up playing Secret of Mana, Final Fantasy, Chrono Trigger, and other great titles. One day, I thought to myself, <em>what if I can only create one more game before I die? What would I create?</em></p>
<p>The answer? Something akin to those favourites; a game that generates a <em>brand new,</em> quality RPG, <em>every time you plan.</em> I spent some weeks brainstorming what I needed and didn't need, plans to create content such as monsters, weapons, etc. Some things clearly need to be procedurally-generated (such as dungeons and maps), while others don't (such as enemy sprites and player skills).</p>
<p>A couple of false-starts later, I finally opened up the Godot editor and started the third (or fourth) attempt.</p>
<h2>The Good: What Went Well</h2>
<p>Initially, I focued on the <em>technical</em> side of procedural generation: creating stuff! As of writing, the game:</p>
<ul>
<li>Generates a new, persistent world map each time; this includes a river that runs into a small lake, and randomly-positioned dungeon entrances</li>
<li>A procedurally-generated forest dungeon; it's a single, large map, with trees, dirt paths, monsters, and a boss.</li>
<li>Procedurally-generated equipment (weapons and armour), each with unique stats modifiers</li>
<li>Loot in the form of treasure chests in the forest dungeon.</li>
<li>The story. While very basic, the game generates the intro plot text, including the town name and final enemy type</li>
</ul>
<p>The forest dungeon took longer than expected. On the technical side, I figured out how to make Godot generate and persist my maps/game; initially with packed scenes (which got garbage-collected when I changed scenes, causing crashes), and later by separating the generation of game data from the presentation (populating scenes/tilemaps/etc. from content).</p>
<p>Solving technical issues aside, I also spent too much time on what didn't go so well: the battle engine.</p>
<h2>The Bad: What Could've Been Better</h2>
<p>I find the concept of memory games fascinating (as an ex-Lumosity player). An Extra Credits video on <a href="https://www.youtube.com/watch?v=oEDVDhOYJ2I">puzzle vs. reflex mechanics</a> challenged me to introduce something new into my game.</p>
<p>At the heart of every RPG, in terms of fun gameplay, lies a fun and challenging battle system. I decided to design a memory-based battle system:</p>
<p><img alt="battle engine animation" src="https://i.imgur.com/vln27Un.gif"></p>
<p>This probably proved to be my undoing. I spent several days designing, balancing, and tweaking the battle engine; adding new features, action types, and skills. Five beta testers provided feedback after trying it out:</p>
<ul>
<li>One really liked it</li>
<li>One said it's okay and could be improved</li>
<li>Three others didn't like it</li>
</ul>
<p>In the end, after several days, I forced myself to stop tweaking/changing it and decided to focus on fulfilling the rest of the game.</p>
<p>Last, and perhaps worst, the game <em>feels</em> incomplete. Sure, you get a randomly-generated forest; but even with the intended scope for the end of the month (two dungeons with two different variations, including unique monsters), it might not be enough to give players that experience of a procedurally-generated RPG.</p>
<h2>What's Next</h2>
<p>I don't intend to give up; I plan to fill out and ship a version of this game (although with what functionality/content remains to be seen). My current plan of action looks like:</p>
<ul>
<li>Finish the end-game sequence so players can actually complete the game</li>
<li>Create two variants on the forest (frost forest and death forest) each with unique enemies</li>
<li>Create a second dungeon (cave) with two variants (one is a volcano)</li>
</ul>
<p>Finally, I plan to create a <em>proper RPG world.</em> A good RPG, like a good novel, contains elements that all harmonize and work together to communicate a singular world/message. Right now, we have a patch of hastily-named enemies, skills, etc. and these need to be brought together.</p>
<p>More specifically, I didn't yet start the other hard/fun part of a procedural RPG: creating a procedural world (and story) that feels unique. This includes a unique/different protagonist for each story.</p>
<p>Finally, another round of beta testing should reveal whether the game is interesting/fun or not, and I should either finish it as-is or if I need to rewrite/rethink battles entirely. Time will tell. September may be almost gone, but October brings another month brimming with potential for me to see this game through to its potential.</p>
<p>If you're interested in following my development on this project, feel free to <a href="https://twitter.com/nightblade99">follow me on Twitter</a>. </p></li>
          <li class="list-group-item text-right">
            <div class="btn-group">
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2018/eman-quest-restrospective-a-procedural-rpg-in-a-month.html#disqus_thread" title="comments">
                <span class="glyphicon glyphicon-comment" data-disqus-identifier="eman-quest-restrospective-a-procedural-rpg-in-a-month">
                </span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2018/eman-quest-restrospective-a-procedural-rpg-in-a-month.html" title="permanent link">
                <span class="glyphicon glyphicon-link"></span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2018/eman-quest-restrospective-a-procedural-rpg-in-a-month.html" title="read more">
                <span class="glyphicon glyphicon-plus"></span></a>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <div class="panel panel-primary">
      <div class="panel-heading panel-title">
        <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018">2018</a> - <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018Month09">September</a>
      <a class="accordion-toggle" data-toggle="collapse" 
        title="toggle folding"
        href="#collapseArticle5">
        <span class="pull-right badge">
          #6
        </span>
      </a>
      </div>

      <div class="panel-body hidden">

      </div>

      <ul class="list-group">
        <a href="https://nightblade9.github.io/godot-gamedev/2018/instance-vs-new-in-godot.html">
          <li class="list-group-item">
            <h1>Instance vs. New in Godot</h1>
          </li>
        </a>
        <div class="collapse in"
          id="collapseArticle5">
          <li class="list-group-item">
              <span id="article_info">
    <a class="label label-primary"
      href="https://nightblade9.github.io/godot-gamedev/category/technical.html">Technical</a>
      <b> · </b>
        <a class="label label-primary"
          href="https://nightblade9.github.io/godot-gamedev/tag/godot.html">Godot</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018">2018</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018Month09">09</a>-<a href="https://nightblade9.github.io/godot-gamedev/archives.html#Year2018Month09">25</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="https://nightblade9.github.io/godot-gamedev/author/nightblade.html">nightblade</a>
  </span>

            <a class="pull-right" href="https://nightblade9.github.io/godot-gamedev/2018/instance-vs-new-in-godot.html">
              </a>
          </li>
          <li class="list-group-item"><p><img alt="godot logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Godot_logo.svg/799px-Godot_logo.svg.png"></p>
<h2>Summary</h2>
<p>Godot provides a way to separate the presentation part of game entities from their underlying data. You can think of this as something akin to the Model-View-Controller design pattern, where scripts (classes/code) respresent the model and instanced scenes (sprite, animation, etc.) represent the presentation and control (eg. collision resolution).</p>
<p>During the development of <a href="https://deengames.itch.io/eman-quest">Eman Quest</a>, we continuously ran into a problem around instancing scenes that are <em>strongly typed</em> and have methods from their corresponding scripts. In fact, there's even <a href="https://github.com/godotengine/godot/issues/15866">an open bug about it</a> as of Godot 3.0.6.</p>
<p>You can find a description of the problem below, along with the solution, and recommendations.</p>
<h2>Why This Became a Problem</h2>
<p>We created Eman Quest as a procedurally-generated RPG; the idea is to generate a persistent, complete world (maps, enemies, etc.) By itself, this proves to be an interesting and troublesome problem to solve, because:</p>
<ul>
<li>In Godot, everything is a scene. Your world map, forest map, etc. are scenes.</li>
<li>You can't easily persist scenes or their entities.</li>
<li>When you change scenes, the old scene -- and all entities -- get garbage-collected.</li>
<li>Fundamentally, you need to separate <em>data from the view/presentation.</em> </li>
</ul>
<p>To solve this, we started initially by generating scenes and saving those; when the GC reared it's dragonish head, we instead moved to saving data as arbitrary JSON (dictionaries) of key/value pairs; when this required maintaining a set of properties twice (eg. monster strength in JSON vs. strength attribute in the instanced scene), we finally moved to <em>creating scenes and matching scripts/classes.</em></p>
<p>Then we broke Godot.</p>
<h2>The Problem and Symptoms</h2>
<p>Near the middle of development, while creating a <code>TreasureChest</code> class, I ran into an interesting problem: although my script file defined several methods and properties (like <code>.open()</code> or <code>.contents</code>), I couldn't call any of them; Godot complained:</p>
<blockquote>
<p>Invalid set index 'contents' (on base: StaticBody2D') with value of type 'Nil'</p>
</blockquote>
<p>Godot identified/typed the instance as <code>StaticBody2D</code>, not <code>TreasureChest</code>. Why?</p>
<p>It turns out the answer lies in the two methods Godot offers to create objects: <code>.instance</code> and <code>.new</code></p>
<h2>Scenes vs. Scripts as Classes</h2>
<p>Naively, Godot offers two ways to create an entity: <code>instance</code> and <code>new</code>.</p>
<p>If it's a <code>Scene</code> with sub-objects (such as a <code>Sprite</code>), you load/preload the <code>.tscn</code>, and call <code>instance</code>. For example: <code>var treasure_chest = load("res://Entities/TreasureChest.tscn").instance()</code>. </p>
<p>This creates the entire hierarchy of sub-scenes. When you call <code>add_child</code> to add it to the scene, Godot calls the <code>_ready</code> function; this is where you put <em>constructor-like</em> code.</p>
<p>Alternatively, if you just have a "class" defined in a script, you load/preload the <code>.gd</code> file and call <code>new</code> on it. For example: <code>var treasure_chest = load("res://Entities/TreasureChest.gd").new(contents, coordinates, etc.)</code>. </p>
<p>In the latter case, you define an <code>_init</code> function for a constructor, and specify whatever parameters you like. This conveniently allows you to specify state and guarantee invariants, such as "treasure chests always have non-null contents."</p>
<p>However, <em>Godot breaks when you cross these two together.</em> If you load a <code>.tscn</code> definition and then call <code>instance</code>, and <em>the class/script back-end has an <code>_init</code> function,</em> the instanced scene doesn't have any of the scripts defined methods/properties.</p>
<h2>Solution and Combining the Two Approaches</h2>
<p>This <em>could</em> be because of timing (when in the life-cycle we're creating the script), I don't know. What I do know, is that removing <code>_init</code> fixes the problem. But then, how do we re-add initialization of the entity's state?</p>
<p>For entities where we use both the instanced scene (in the place where we populate the tilemaps, etc. on-screen) and the script only (as the generated back-end data/object), we decided on the following approach:</p>
<ul>
<li>Don't use <code>_init</code>. It could lead to this obscure bug again later, and suck up a ton of time to figure out.</li>
<li>To construct a new object class/script instance, create an <code>initialize</code> method and use that as the constructor. This is where we can set state/invariants, etc.</li>
<li>Keep a single scene for the presentation, and use a script to keep all the back-end class code (properties/methods)</li>
<li>When we need to instance the actual scene tree for that object -- such as with monsters or treasure chests -- keep the data object separate, and create an <code>initialize_from</code> instance.</li>
<li><code>initialize_from</code> sets all the properties on the scene (such as presentation: is the treasure chest already opened or not?) based on the properties of the class/data object underlying.</li>
</ul>
<p>This approach also solved other problems, such as keeping references to instances across scenes. Godot doesn't like this, because it tries to GC everything. Storing the data separately neatly (sometimes in a singleton script) solves this problem.</p>
<h2>Conclusion and Future Improvements</h2>
<p>This solution solves our problem neatly. It keeps our code DRY, by using one definition of an entity's properties. It allows us to separate presentation from model/data, which is useful to prevent coupling.</p>
<p>But, it's not ideal. At best, we can use <code>_init</code> judiciously for entities that we know we'll never show in a scene. We can always resort to using data (dictionaries/JSON) instead of classes; we miss out on code completion, but this better represents entity-component systems with data-driven design.</p>
<p>Did you ever run into this problem? Do you see a better way of solving it? Drop a comment and let us know, we would really love to hear about better solutions to this problem.</p></li>
          <li class="list-group-item text-right">
            <div class="btn-group">
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2018/instance-vs-new-in-godot.html#disqus_thread" title="comments">
                <span class="glyphicon glyphicon-comment" data-disqus-identifier="instance-vs-new-in-godot">
                </span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2018/instance-vs-new-in-godot.html" title="permanent link">
                <span class="glyphicon glyphicon-link"></span></a>
              <a class="btn btn-primary" href="https://nightblade9.github.io/godot-gamedev/2018/instance-vs-new-in-godot.html" title="read more">
                <span class="glyphicon glyphicon-plus"></span></a>
            </div>
          </li>
        </div>
      </ul>
    </div>
  </div>
        </div>

        <div class="row">
      <ul class="pagination">

        <li>
            <a href="index2.html">&laquo;</a>
        </li>

        <li>
          <a href="https://nightblade9.github.io/godot-gamedev/index.html">1<span class="sr-only">(current)</span></a>
        </li>
        <li>
          <a href="https://nightblade9.github.io/godot-gamedev/index2.html">2<span class="sr-only">(current)</span></a>
        </li>
        <li class="active">
          <a>3<span class="sr-only">(current)</span></a>
        </li>
        <li>
          <a href="https://nightblade9.github.io/godot-gamedev/index4.html">4<span class="sr-only">(current)</span></a>
        </li>

        <li>
          <a href="index4.html">&raquo;</a>
        </li>

    </ul>

        </div>

      </div>

      <div class="col-md-2">
      </div>
    </div>


  </div>

    <nav id="footer" class="navbar navbar-default">
    <div class="container">
        <p id="footer-text" class="navbar-text text-center">
          Copyright &copy; <a href="https://twitter.com/nightblade99">NightBlade</a>, 2018+. All rights reserved.
        </p>
      </div>
    </div>
  </nav>


</body>
</html>